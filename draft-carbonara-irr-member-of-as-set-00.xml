<?xml version="1.0" encoding="UTF-8"?>
<rfc version="3"
     category="std"
     docName="draft-carbonara-irr-member-of-as-set-00"
     ipr="trust200902"
     submissionType="IETF"
     consensus="true"
     tocInclude="true"
     tocDepth="3"
     xml:lang="en">

  <front>
    <title abbrev="Member-of-AS-SET">
      Membership Verification for Autonomous System Sets (AS-SETs)
    </title>

    <seriesInfo name="Internet-Draft" value="draft-carbonara-irr-member-of-as-set-00"/>

    <author fullname="Saku Ytti" initials="S." surname="Ytti">
      <organization>NTT Communications Corporation</organization>
      <address>
        <email>saku@ytti.cy</email>
      </address>
    </author>

    <date year="2026" month="February" day="22"/>

    <area>RTG</area>
    <workgroup>Global Routing Operations</workgroup>
    <keyword>IRR</keyword>
    <keyword>BGP</keyword>
    <keyword>AS-SET</keyword>
    <keyword>RPKI</keyword>

    <abstract>
      <t>
        This document defines a new object type, member-of-as-set, for use in
        Internet Routing Registry (IRR) databases. The member-of-as-set object
        enables autonomous systems to declare membership in AS-SET objects,
        creating bidirectional verification of AS-SET expansions.
      </t>
      <t>
        The member-of-as-set object provides a lightweight, backward-compatible
        mechanism that allows network operators to verify that an autonomous
        system listed in an AS-SET has authorized such inclusion. When used in
        conjunction with existing tools such as bgpq4, this verification enables
        automated pruning of unauthorized autonomous systems from AS-SET
        expansions.
      </t>
    </abstract>
  </front>

  <middle>
    <section anchor="introduction">
      <name>Introduction</name>
      <t>
        Internet Routing Registry (IRR) databases <xref target="RFC2622"/>
        have long been used by network operators to generate BGP route filters.
        The Routing Policy Specification Language (RPSL) defines the as-set
        object, which represents a set of autonomous systems.
      </t>
      <t>
        A fundamental limitation of current AS-SET objects is their
        unidirectional nature. An AS-SET owner can include any autonomous
        system without requiring authorization. This creates a security
        vulnerability where malicious operators can include high-value
        autonomous systems in their AS-SET.
      </t>
      <t>
        While RPKI <xref target="RFC6480"/> provides origin validation,
        it does not prevent route leaks. Similarly, ASPA
        <xref target="RFC9595"/> provides AS path validation but has
        seen limited deployment.
      </t>
      <t>
        This document defines the member-of-as-set object to enable
        bidirectional verification with the following goals:
        authorization of AS-SET membership, verification during expansion,
        backward compatibility, incremental deployment, and complementarity
        with existing mechanisms.
      </t>
    </section>

    <section anchor="terminology">
      <name>Terminology</name>
      <t>
        The key words <bcp14>MUST</bcp14>, <bcp14>MUST NOT</bcp14>,
        <bcp14>REQUIRED</bcp14>, <bcp14>SHALL</bcp14>, <bcp14>SHALL NOT</bcp14>,
        <bcp14>SHOULD</bcp14>, <bcp14>SHOULD NOT</bcp14>,
        <bcp14>RECOMMENDED</bcp14>, <bcp14>MAY</bcp14>, and
        <bcp14>OPTIONAL</bcp14> in this document are to be interpreted as
        described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/>.
      </t>
      <dl spacing="normal">
        <dt>AS-SET:</dt>
        <dd>An RPSL object representing a set of ASNs, per <xref target="RFC2622"/>.</dd>
        <dt>Member-of-AS-SET:</dt>
        <dd>An RPSL object allowing an AS to declare AS-SET membership.</dd>
        <dt>AS-SET Expansion:</dt>
        <dd>Recursively resolving an AS-SET to obtain all ASNs.</dd>
        <dt>Root AS-SET:</dt>
        <dd>The AS-SET from which an expansion begins.</dd>
      </dl>
    </section>

    <section anchor="background">
      <name>Relationship to Existing RPSL Mechanisms</name>
      <t>
        RFC 2622 <xref target="RFC2622"/> Section 6 defines an optional
        <em>member-of</em> attribute within the aut-num object. This attribute
        works in conjunction with the mbrs-by-ref attribute in as-set objects
        to enable indirect membership declarations.
      </t>
      <t>
        The existing mechanism has significant limitations:
      </t>
      <ul spacing="normal">
        <li>It is maintainer-centric (relies on mnt-by matching mbrs-by-ref)</li>
        <li>It requires the aut-num object to exist in the database</li>
        <li>The AS-SET owner cannot directly control membership</li>
        <li>There is no way for an AS to opt-out of unwanted inclusions</li>
      </ul>
      <t>
        The member-of-as-set object defined in this document provides a
        fundamentally different mechanism that addresses these limitations:
      </t>
      <ul spacing="normal">
        <li>It is a standalone object type (not an attribute within aut-num)</li>
        <li>It enables mandatory bidirectional verification</li>
        <li>It allows ASes to proactively authorize (or deny) AS-SET inclusion</li>
        <li>It does not require the aut-num object to exist</li>
      </ul>
      <t>
        Both mechanisms can coexist. An AS may use either or both depending
        on their operational requirements and the capabilities of their
        IRR registry.
      </t>
    </section>

    <section anchor="object">
      <name>The member-of-as-set Object</name>
      <t>
        The member-of-as-set object is an RPSL object that allows autonomous
        systems and AS-SETs to declare membership in AS-SETs. This serves
        as authorization for inclusion.
      </t>
      
      <section anchor="object-template">
        <name>Object Template</name>
        <t>
          The member-of-as-set object follows the standard RPSL object format
          defined in <xref target="RFC2622"/>.
        </t>
        <sourcecode type="text">
Attribute          Value                      Type
member-of-as-set   list of &lt;as-numbers&gt; or     mandatory, multi-valued,
                   &lt;as-set-names&gt;             class key
member-of          list of &lt;as-set-names&gt;     mandatory, multi-valued
mnt-by             list of &lt;mntner-names&gt;     mandatory, multi-valued
admin-c            &lt;nic-handle&gt;               mandatory, multi-valued
tech-c             &lt;nic-handle&gt;               mandatory, multi-valued
remarks            &lt;free-form&gt;                optional, multi-valued
notify             &lt;email-address&gt;            optional, multi-valued
changed            &lt;email-address&gt; &lt;date&gt;     mandatory, multi-valued
source             &lt;registry-name&gt;            mandatory, single-valued
        </sourcecode>
        <t>
          The class key is the combination of all values in the member-of-as-set
          attribute. Each entry is either an autonomous system number or an AS-SET
          name. The combination of (object class, all member-of-as-set values)
          uniquely identifies a member-of-as-set object within an IRR database.
        </t>
      </section>

      <section anchor="object-attr">
        <name>Attribute Definitions</name>
        
        <section anchor="attr-member-of-as-set">
          <name>The member-of-as-set Attribute</name>
          <t>
            The member-of-as-set attribute specifies the identifiers that this
            object describes. It serves as the primary key for the object.
            The attribute <bcp14>MAY</bcp14> contain one or more autonomous system
            numbers and/or AS-SET names, allowing both individual ASNs and AS-SETs
            themselves to declare membership authorization:
          </t>
          <ul spacing="normal">
            <li>If a value is an AS number (e.g., AS3245), the object
            authorizes that ASN's inclusion in the listed AS-SETs</li>
            <li>If a value is an AS-SET name (e.g., AS-HURRICANE), the object
            authorizes that AS-SET's inclusion as a member of other AS-SETs</li>
          </ul>
          <sourcecode type="text">
member-of-as-set: AS3245
member-of-as-set: AS64501
member-of-as-set: AS-HURRICANE
          </sourcecode>
          <t>
            Each value <bcp14>MUST</bcp14> be either:
          </t>
          <ul spacing="normal">
            <li>A valid autonomous system number formatted according to
            <xref target="RFC2622"/>, using the AS&lt;number&gt; notation
            (e.g., AS3245, AS6939, AS65001); or</li>
            <li>A valid AS-SET name following the naming conventions defined
            in <xref target="RFC2622"/> Section 5 (e.g., AS-HURRICANE,
            AS2914:AS-GLOBAL)</li>
          </ul>
        </section>

        <section anchor="attr-member-of">
          <name>The member-of Attribute</name>
          <t>
            The member-of attribute lists the AS-SET objects in which the
            autonomous systems and AS-SETs declare membership. Each value
            authorizes inclusion in the specified AS-SET.
          </t>
          <sourcecode type="text">
member-of: AS3245:LOCAL-PEERING
member-of: AS3245:CUSTOMERS
          </sourcecode>
          <t>
            AS-SET names in the member-of attribute <bcp14>MUST</bcp14> follow
            the naming conventions defined in <xref target="RFC2622"/> Section 5.
          </t>
        </section>

        <section anchor="attr-other">
          <name>Other Attributes</name>
          <t>
            The admin-c, tech-c, mnt-by, remarks, notify, changed, and source
            attributes are used as defined in <xref target="RFC2622"/>.
          </t>
        </section>
      </section>

      <section anchor="semantics">
        <name>Object Semantics</name>
        <t>
          By including an AS-SET name in the member-of attribute, the
          autonomous systems and AS-SETs listed in member-of-as-set authorize
          their inclusion in expansions of that AS-SET.
        </t>
        <t>
          If a member-of-as-set object exists for an autonomous system or AS-SET,
          the member-of attribute contains an <bcp14>exhaustive whitelist</bcp14>
          of AS-SETs in which the system or AS-SET authorizes inclusion.
          Verification tools <bcp14>MUST</bcp14> only include the system or AS-SET
          in expansions of AS-SETs explicitly listed in the member-of attribute.
          If an AS-SET expansion includes the system or AS-SET but that AS-SET is
          <bcp14>NOT</bcp14> listed in the member-of attribute, verification
          tools <bcp14>MUST</bcp14> prune the system or AS-SET from the expansion.
        </t>
        <t>
          If no member-of-as-set object exists for an autonomous system or AS-SET,
          verification tools <bcp14>MUST</bcp14> include the system or AS-SET
          (backward compatibility) unless configured otherwise.
        </t>
        <t>
          The member-of-as-set object coexists with the aut-num and as-set objects
          but serves a different purpose. The aut-num object defines routing
          policy, the as-set object defines a set of autonomous systems, and
          the member-of-as-set object defines AS-SET membership authorization.
          All objects may exist for the same autonomous system or AS-SET.
        </t>
      </section>

      <section anchor="example-objects">
        <name>Example Objects</name>
        <t>
          Example member-of-as-set object for Sofia University (AS3245):
        </t>
        <sourcecode type="text">
member-of-as-set: AS3245
member-of:        AS3245:LOCAL-PEERING
mnt-by:           MNTR-SOFIA-UNI
admin-c:          DK58
tech-c:           OPS4-RIPE
remarks:          Sofia University only authorizes local peering AS-SET
remarks:          NOT Hurricane Electric or other global AS-SETs
changed:          admin@sofia-uni.bg 20260222
source:           RIPE
        </sourcecode>
        <t>
          Example for Hurricane Electric (AS6939):
        </t>
        <sourcecode type="text">
member-of-as-set: AS6939
member-of:        AS-HURRICANE
mnt-by:           MAINT-AS6939
admin-c:          HE-ADMIN
tech-c:           HE-OPS
changed:          ops@he.net 20260222
source:           RADB
        </sourcecode>
        <t>
          Example for AS-HURRICANE itself (authorizing inclusion in other AS-SETs):
        </t>
        <sourcecode type="text">
member-of-as-set: AS-HURRICANE
member-of:        AS-GLOBAL-TRANSIT
mnt-by:           MAINT-AS6939
admin-c:          HE-ADMIN
tech-c:           HE-OPS
remarks:          Hurricane Electric authorizes inclusion in global transit AS-SET
remarks:          NOT in customer or regional AS-SETs
changed:          ops@he.net 20260222
source:           RADB
        </sourcecode>
        <t>
          Example with multiple ASNs (enterprise with multiple AS numbers):
        </t>
        <sourcecode type="text">
member-of-as-set: AS64501
member-of-as-set: AS64502
member-of-as-set: AS64503
member-of:        AS-ENTERPRISE-TRANSIT
member-of:        AS-GLOBAL-PEERING
mnt-by:           MNTR-ENTERPRISE
admin-c:          ENT1-RIPE
tech-c:           ENT2-RIPE
remarks:          Enterprise authorizes all ASNs in transit and peering AS-SETs
changed:          admin@enterprise.com 20260222
source:           RIPE
        </sourcecode>
      </section>
    </section>

    <section anchor="query">
      <name>Query and Lookup</name>
      <t>
        The member-of-as-set object <bcp14>SHOULD</bcp14> be queried using
        class-qualified lookup to avoid ambiguity with aut-num objects:
      </t>
      <sourcecode type="text">
whois -h whois.ripe.net "member-of-as-set AS3245"
      </sourcecode>
      <t>
        This returns the member-of-as-set object for AS3245, distinct from
        the aut-num object which would be returned by:
      </t>
      <sourcecode type="text">
whois -h whois.ripe.net "AS3245"
      </sourcecode>
      <t>
        IRR software <bcp14>SHOULD</bcp14> support class-qualified queries
        as defined in <xref target="RFC2622"/>.
      </t>
    </section>

    <section anchor="verification">
      <name>Verification Mechanism</name>
      <t>
        Given an AS-SET S to be expanded, the verification algorithm is:
      </t>
      <ol spacing="normal">
        <li>Recursively expand AS-SET S to obtain all autonomous systems.</li>
        <li>For each autonomous system AS:</li>
      </ol>
      <t>
        Query the IRR for a member-of-as-set object where AS appears in the
        member-of-as-set attribute. If none exists, include AS (backward
        compatibility). If a member-of-as-set object exists, check if S appears
        in the member-of attribute. Include AS if yes, prune if no.
      </t>
      <t>
        Finally, return the filtered set.
      </t>

      <section anchor="verification-algorithm">
        <name>Detailed Verification Algorithm</name>
        <sourcecode type="text">
function expandAndVerify(asSet, rootSet):
    candidates = expandAsSet(asSet)
    authorized = []
    
    for asn in candidates:
        memberObj = queryMemberOfAsSet(asn)
        
        if memberObj is null:
            # No authorization object exists
            # Include for backward compatibility
            authorized.append(asn)
        else:
            # Check if root AS-SET is authorized
            if rootSet in memberObj.memberOf:
                authorized.append(asn)
            else:
                # PRUNE: not authorized
                logPruned(asn, rootSet)
    
    return authorized
        </sourcecode>
      </section>

      <section anchor="tools">
        <name>Implementation in Tools</name>
        <t>
          Tools that expand AS-SETs <bcp14>SHOULD</bcp14> support
          verification. They <bcp14>SHOULD</bcp14>:
        </t>
        <ul spacing="normal">
          <li>Query IRR databases for member-of-as-set objects</li>
          <li>Provide enable/disable options for verification</li>
          <li>Default to disabled to maintain backward compatibility</li>
          <li>Log pruned systems with reasons</li>
          <li>Cache objects for performance</li>
          <li>Support multiple IRR sources</li>
        </ul>
      </section>
    </section>

    <section anchor="deployment">
      <name>Deployment Considerations</name>
      <t>
        The mechanism is backward compatible: non-participating autonomous
        systems are included as today; non-supporting tools work without
        modification; IRR software requires object type registration.
      </t>
      <t>
        Deployment proceeds incrementally:
      </t>
      <ol spacing="normal">
        <li>IRR software adds support for the new object type</li>
        <li>Tools add verification capabilities</li>
        <li>Large autonomous systems create member-of-as-set objects</li>
        <li>Providers enable verification in their filter generation</li>
      </ol>
      <t>
        Member-of-as-set complements RPKI and ASPA. It does not replace
        RPKI origin validation but adds AS path validation during
        AS-SET expansion.
      </t>
    </section>

    <section anchor="security">
      <name>Security Considerations</name>
      <t>
        The mechanism addresses unauthorized AS-SET inclusion, accidental
        misconfiguration, and BGP optimizer leaks.
      </t>
      <t>
        Incomplete lists risk filtering legitimate routes. Attackers with
        compromised credentials can create false objects. Verification
        occurs during filter generation, not BGP operation.
      </t>
      <t>
        Networks <bcp14>SHOULD</bcp14> use strong authentication
        <xref target="RFC2726"/>, monitor expansions, and automate
        object updates.
      </t>
      <t>
        The member-of-as-set object is maintained by the autonomous system
        or AS-SET owner (via mnt-by). This ensures that only authorized parties can
        declare AS-SET membership, unlike the existing mbrs-by-ref mechanism
        which relies on maintainer trust relationships.
      </t>
    </section>

    <section anchor="iana">
      <name>IANA Considerations</name>
      <t>
        Per <xref target="RFC2622"/> Section 10, this document extends RPSL
        with a new object type and attributes.
      </t>
      <t>
        IANA is requested to register the following in the RPSL Object
        Types registry:
      </t>
      <sourcecode type="text">
Object Type: member-of-as-set
Reference: RFC XXXX (this document)
Status: Current
Contact: IETF GROW Working Group
      </sourcecode>
      <t>
        IANA is requested to register the following attributes in the
        RPSL Attributes registry:
      </t>
      <sourcecode type="text">
Attribute: member-of-as-set
Object Types: member-of-as-set
Reference: RFC XXXX (this document)
Status: Current

Attribute: member-of
Object Types: member-of-as-set, aut-num
Reference: RFC XXXX (this document) for member-of-as-set;
          RFC 2622 for aut-num
Status: Current
Note: The member-of attribute has different semantics in
      member-of-as-set objects versus aut-num objects
      </sourcecode>
    </section>
  </middle>

  <back>
    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>
        <reference anchor="RFC2119" target="https://www.rfc-editor.org/info/rfc2119">
          <front>
            <title>Key words for use in RFCs to Indicate Requirement Levels</title>
            <author fullname="S. Bradner" initials="S." surname="Bradner"/>
            <date year="1997"/>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="2119"/>
        </reference>
        <reference anchor="RFC2622" target="https://www.rfc-editor.org/info/rfc2622">
          <front>
            <title>Routing Policy Specification Language (RPSL)</title>
            <author fullname="C. Alaettinoglu" initials="C." surname="Alaettinoglu"/>
            <author fullname="C. Villamizar" initials="C." surname="Villamizar"/>
            <author fullname="E. Gerich" initials="E." surname="Gerich"/>
            <date year="1999"/>
          </front>
          <seriesInfo name="RFC" value="2622"/>
        </reference>
        <reference anchor="RFC2726" target="https://www.rfc-editor.org/info/rfc2726">
          <front>
            <title>PGP Authentication for RIPE Database Updates</title>
            <author fullname="L. Blunk" initials="L." surname="Blunk"/>
            <date year="1999"/>
          </front>
          <seriesInfo name="RFC" value="2726"/>
        </reference>
        <reference anchor="RFC8174" target="https://www.rfc-editor.org/info/rfc8174">
          <front>
            <title>Ambiguity of Key Words</title>
            <author fullname="B. Leiba" initials="B." surname="Leiba"/>
            <date year="2017"/>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="8174"/>
        </reference>
      </references>
      <references>
        <name>Informative References</name>
        <reference anchor="RFC6480" target="https://www.rfc-editor.org/info/rfc6480">
          <front>
            <title>RPKI Infrastructure</title>
            <author fullname="M. Lepinski" initials="M." surname="Lepinski"/>
            <date year="2012"/>
          </front>
          <seriesInfo name="RFC" value="6480"/>
        </reference>
        <reference anchor="RFC9595" target="https://www.rfc-editor.org/info/rfc9595">
          <front>
            <title>BGP ASPA</title>
            <author fullname="K. Weber" initials="K." surname="Weber"/>
            <date year="2024"/>
          </front>
          <seriesInfo name="RFC" value="9595"/>
        </reference>
      </references>
    </references>
    <section anchor="acknowledgments" numbered="false">
      <name>Acknowledgments</name>
      <t>
        Thanks to the #networker IRC community for discussions leading
        to this proposal.
      </t>
    </section>
  </back>
</rfc>
